"use strict";(self.webpackChunkwre_frontend=self.webpackChunkwre_frontend||[]).push([[562],{2562:(e,t,i)=>{i.r(t),i.d(t,{default:()=>p});var s=i(6540),a=i(8941),n=i(5254),r=i(888),l=i(6930),o=i(4848);const d=e=>{let{onListingAdded:t}=e;const{agents:i,loading:d,error:c}=(0,n._)(),[u,h]=(0,s.useState)({}),[p,m]=(0,s.useState)({mlsId:"",compensation:"",address:"",city:"",zip:"",listingBroker:"",phone:"",email:""}),g={color:"red",fontSize:"14px",marginTop:"5px"},x={width:"100%",padding:"15px",fontSize:"18px",border:"2px solid #ccc",borderRadius:"5px",boxSizing:"border-box"},j={marginBottom:"5px",fontSize:"18px",fontWeight:"bold",color:"white"},y=e=>{const{name:t,value:s}=e.target;if(m((e=>({...e,[t]:s}))),h((e=>({...e,[t]:""}))),"listingBroker"===t){const e=Object.values(i).find((e=>e.Name===s));e&&(m((t=>({...t,phone:e.CellNumber,email:e.Email}))),h((e=>({...e,phone:"",email:""}))))}};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.l$,{position:"top-right",toastOptions:{duration:5e3,style:{background:"#363636",color:"#fff"}}}),(0,o.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const i={};if((0,l.en)(p.mlsId)||(i.mlsId="Valid MLS ID is required."),(0,l.p)(p.compensation)||(i.compensation="Compensation must be a number between 0 and 100."),(0,l.jl)(p.address)||(i.address="Address is required."),(0,l.Y$)(p.city)||(i.city="City is required."),(0,l.q9)(p.zip)||(i.zip="Valid ZIP code is required."),(0,l.O2)(p.listingBroker)||(i.listingBroker="Listing broker is required."),(0,l.FY)(p.phone)||(i.phone="Valid phone number is required."),(0,l.DT)(p.email)||(i.email="Valid email is required."),Object.keys(i).length>0)return h(i),void r.Ay.error("Please correct the errors in the form.");try{const e=localStorage.getItem("token"),i=await fetch(`${a.A.SERVER_URL}/api/v1/listings`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(p)});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);await i.json();t(),m({mlsId:"",compensation:"",address:"",city:"",zip:"",listingBroker:"",phone:"",email:""}),h({}),r.Ay.success("Listing added successfully!")}catch(e){r.Ay.error("Failed to add listing. Please try again.")}},style:{maxWidth:"800px",margin:"0 auto",padding:"20px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px","@media (max-width: 768px)":{gridTemplateColumns:"1fr",gap:"10px"}},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:j,children:"MLS ID"}),(0,o.jsx)("input",{style:x,name:"mlsId",value:p.mlsId,onChange:y,placeholder:"MLS ID",required:!0,"data-testid":"mls-id-input"}),u.mlsId&&(0,o.jsx)("p",{style:g,children:u.mlsId})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:j,children:"Compensation %"}),(0,o.jsx)("input",{style:x,name:"compensation",value:p.compensation,onChange:y,placeholder:"Compensation %",required:!0,"data-testid":"compensation-input"}),u.compensation&&(0,o.jsx)("p",{style:g,children:u.compensation})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:j,children:"Address"}),(0,o.jsx)("input",{style:x,name:"address",value:p.address,onChange:y,placeholder:"Address",required:!0,"data-testid":"address-input"}),u.address&&(0,o.jsx)("p",{style:g,children:u.address})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:j,children:"City/Town"}),(0,o.jsx)("input",{style:x,name:"city",value:p.city,onChange:y,placeholder:"City/Town",required:!0,"data-testid":"city-input"}),u.city&&(0,o.jsx)("p",{style:g,children:u.city})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:j,children:"ZIP"}),(0,o.jsx)("input",{style:x,name:"zip",value:p.zip,onChange:y,placeholder:"ZIP",required:!0,"data-testid":"zip-input"}),u.zip&&(0,o.jsx)("p",{style:g,children:u.zip})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:j,children:"Listing Broker"}),(0,o.jsxs)("select",{style:x,name:"listingBroker",value:p.listingBroker,onChange:y,required:!0,"data-testid":"listing-broker-select",children:[(0,o.jsx)("option",{value:"",children:"Select an agent"}),d?(0,o.jsx)("option",{disabled:!0,children:"Loading agents..."}):Object.values(i).map((e=>(0,o.jsx)("option",{value:e.Name,children:e.Name},e.MATRIX_UNIQUE_ID)))]}),u.listingBroker&&(0,o.jsx)("p",{style:g,children:u.listingBroker})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:j,children:"Phone"}),(0,o.jsx)("input",{style:x,name:"phone",value:p.phone,onChange:y,placeholder:"Phone",required:!0,"data-testid":"phone-select"}),u.phone&&(0,o.jsx)("p",{style:g,children:u.phone})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{style:j,children:"Email"}),(0,o.jsx)("input",{style:x,name:"email",value:p.email,onChange:y,placeholder:"Email",required:!0,"data-testid":"email-select"}),u.email&&(0,o.jsx)("p",{style:g,children:u.email})]}),(0,o.jsx)("button",{type:"submit",style:{gridColumn:"span 2",padding:"15px 30px",fontSize:"20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"10px",cursor:"pointer",marginTop:"20px"},"data-testid":"add-listing-button",children:"Add Listing"})]})]})};var c=i(3888),u=i(1530);const h=e=>{let{refreshKey:t}=e;const[i,n]=(0,s.useState)([]),[r,d]=(0,s.useState)(null),[h,p]=(0,s.useState)({}),[m,g]=(0,s.useState)(!1),[x,j]=(0,s.useState)(!1);(0,s.useEffect)((()=>{const e=localStorage.getItem("token");g(!!e),b(),j((0,l.Fr)())}),[t]);const y=(0,c.FB)(),b=async()=>{try{const e=await fetch(`${a.A.SERVER_URL}/api/v1/listings`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();n(t)}catch(e){}},f=e=>{const{name:t,value:i}=e.target;p((e=>({...e,[t]:i})))},w=[y.accessor("mlsId",{header:"MLS ID",cell:e=>r===e.row.original._id?(0,o.jsx)("input",{name:"mlsId",value:h.mlsId||"",onChange:f}):(0,l.Zr)(e.getValue())}),y.accessor("compensation",{header:"Fees",cell:e=>r===e.row.original._id?(0,o.jsx)("input",{name:"compensation",value:h.fees||"",onChange:f}):`${parseFloat(e.getValue()).toFixed(1)}%`}),y.accessor("address",{header:"Address",cell:e=>r===e.row.original._id?(0,o.jsx)("input",{name:"address",value:h.address||"",onChange:f}):(0,l.Zr)(e.getValue())}),y.accessor("city",{header:"City",cell:e=>r===e.row.original._id?(0,o.jsx)("input",{name:"city",value:h.city||"",onChange:f}):(0,l.Zr)(e.getValue())}),y.accessor("zip",{header:"Zip",cell:e=>r===e.row.original._id?(0,o.jsx)("input",{name:"zip",value:h.zip||"",onChange:f}):e.getValue()}),y.accessor("listingBroker",{header:"Agent",cell:e=>r===e.row.original._id?(0,o.jsx)("input",{name:"listingBroker",value:h.listingBroker||"",onChange:f}):(0,l.Zr)(e.getValue())}),y.accessor("phone",{header:"Phone",cell:e=>r===e.row.original._id?(0,o.jsx)("input",{name:"phone",value:h.phone||"",onChange:f}):e.getValue()}),...x?[]:[y.accessor("email",{header:"Email",cell:e=>r===e.row.original._id?(0,o.jsx)("input",{name:"email",value:h.email||"",onChange:f,className:"email-column"}):e.getValue()})],...m?[{header:"Actions",cell:e=>r===e.row.original._id?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{className:"button",onClick:()=>(async e=>{try{const t=localStorage.getItem("token"),i=await fetch(`${a.A.SERVER_URL}/api/v1/listings/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(h)});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);await i.json(),d(null),b()}catch(e){}})(e.row.original._id),children:"Save"}),(0,o.jsx)("button",{className:"button cancel",onClick:()=>d(null),children:"Cancel"})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{className:"button",onClick:()=>{return t=e.row,d(t.original._id),void p({...t.original});var t},children:"Edit"}),(0,o.jsx)("button",{className:"button delete",onClick:()=>(async e=>{try{const t=localStorage.getItem("token"),i=await fetch(`${a.A.SERVER_URL}/api/v1/listings/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);await i.json(),b()}catch(e){}})(e.row.original._id),"data-testid":`delete-button-${e.row.original.mlsId}`,children:"Delete"})]})}]:[]],v=(0,u.N4)({data:i,columns:w,getCoreRowModel:(0,c.HT)()});return(0,o.jsxs)("div",{className:"table-container",children:[(0,o.jsxs)("table",{className:"buyer-broker-table","data-testid":"buyer-broker-table",children:[(0,o.jsx)("thead",{children:v.getHeaderGroups().map((e=>(0,o.jsx)("tr",{children:e.headers.map((e=>(0,o.jsx)("th",{className:"table-header",children:e.isPlaceholder?null:(0,u.Kv)(e.column.columnDef.header,e.getContext())},e.id)))},e.id)))}),(0,o.jsx)("tbody",{children:v.getRowModel().rows.map((e=>(0,o.jsx)("tr",{"data-testid":`table-row-${e.original.mlsId}`,children:e.getVisibleCells().map((e=>(0,o.jsx)("td",{className:"table-cell","data-label":e.column.columnDef.header,children:(0,u.Kv)(e.column.columnDef.cell,e.getContext())},e.id)))},e.id)))})]}),(0,o.jsx)("div",{className:"table-footer-space"})]})},p=e=>{let{isLoggedIn:t,setIsLoggedIn:i}=e;const[a,n]=(0,s.useState)(0),[r,l]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{const e=setTimeout((()=>{l(!0)}),100);return()=>clearTimeout(e)}),[]),(0,o.jsxs)("div",{className:r?"listings-manager-loaded":"listings-manager-loading",children:[(0,o.jsx)("h1",{className:"page-title",children:"Buyer Broker Commission"}),t?(0,o.jsx)(d,{onListingAdded:()=>{n((e=>e+1))}}):(0,o.jsx)(o.Fragment,{}),(0,o.jsx)("p",{className:"child-text",children:"View our companyâ€™s listings with sellers offering buyer broker compensation in Connecticut & New York"}),(0,o.jsx)(h,{refreshKey:a})]})}}}]);